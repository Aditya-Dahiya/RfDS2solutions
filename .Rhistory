left_join(delayhours) |>
mutate(
del_hrs = if_else(is.na(avg_delay),
"Other hours",
"Hours with max delays"),
precip = precip * 25.4
) |>
pivot_longer(
cols = c(temp, dewp, humid, precip, visib),
names_to = "variable",
values_to = "values"
) |>
group_by(origin, del_hrs, variable) |>
summarise(means = mean(values, na.rm = TRUE)) |>
ggplot(aes(x = del_hrs, y = means, fill = del_hrs)) +
geom_bar(stat = "identity") +
facet_wrap( ~ variable, scales = "free", ncol = 5,
labeller = labeller(variable = var_labels)) +
scale_fill_brewer(palette = "Dark2") +
theme_minimal() +
theme(panel.grid.major.x = element_blank(),
axis.title = element_blank(),
axis.text.x = element_blank(),
legend.position = "bottom")  +
labs(subtitle = "Weather Patterns for John F Kennedy Airport (JFK)",
fill = "")
g3 = weather |>
filter(origin == "LGA") |>
left_join(delayhours) |>
mutate(
del_hrs = if_else(is.na(avg_delay),
"Other hours",
"Hours with max delays"),
precip = precip * 25.4
) |>
pivot_longer(
cols = c(temp, dewp, humid, precip, visib),
names_to = "variable",
values_to = "values"
) |>
group_by(origin, del_hrs, variable) |>
summarise(means = mean(values, na.rm = TRUE)) |>
ggplot(aes(x = del_hrs, y = means, fill = del_hrs)) +
geom_bar(stat = "identity") +
facet_wrap( ~ variable, scales = "free", ncol = 5,
labeller = labeller(variable = var_labels)) +
scale_fill_brewer(palette = "Dark2") +
theme_minimal() +
theme(panel.grid.major.x = element_blank(),
axis.title = element_blank(),
axis.text.x = element_blank(),
legend.position = "bottom")  +
labs(subtitle = "Weather Patterns for La Guardia Airport (LGA)",
fill = "")
library(patchwork)
g1 / g2 / g3 + plot_layout(guides = "collect")
g1 / g2 / g3 + plot_layout(guides = "collect") + theme(legend.position = "bottom")
g1 / g2 / g3 + plot_layout(guides = "collect") & theme(legend.position = "bottom")
delayhours |>
ggplot(aes(y = time_hour, x = avg_delay)) +
geom_point(size = 2, alpha = 0.5) +
facet_wrap(~origin, dir = "h") +
theme_minimal() +
labs(x = "Average delay during the hour (in mins.)", y = NULL,
subtitle = "The worst 48 hours, in terms of departure delays, are similar in pattern across the 3 airports.")
top_dest <- flights2 |>
count(dest, sort = TRUE) |>
head(10)
flights2 <- flights |>
mutate(id = row_number(), .before = 1)
top_dest <- flights2 |>
count(dest, sort = TRUE) |>
head(10)
top_dest
flights |>
filter(dest %in% top_dest |> as_vector())
top_dest |> as_vector()
top_dest_vec <- top_dest |> select(dest) |> as_vector()
flights |>
filter(dest %in% top_dest_vec)
flights |>
filter(dest %in% top_dest_vec) |>
distinct(dest)
flights2 <- flights |>
mutate(id = row_number(), .before = 1)
top_dest <- flights2 |>
count(dest, sort = TRUE) |>
head(10)
top_dest_vec <- top_dest |> select(dest) |> as_vector()
flights |>
filter(dest %in% top_dest_vec)
flights |>
left_join(weather, by = join_by(time_hour))
flights |>
left_join(weather)
flights |>
select(year, month, day, origin, dest, time_hour) |>
left_join(weather)
weather |> naniar::vis_miss()
flights |>
select(year, month, day, origin, dest, time_hour) |>
left_join(weather) |>
summarise(
missing_temp = mean(is.na(temp)),
missing_dewp = mean(is.na(dewp))
)
weather |> |>
weather |>
summarise(
missing_temp = mean(is.na(temp)),
missing_dewp = mean(is.na(dewp))
)
weather |>
filter(is.na(temp))
flights |>
select(year, month, day, origin, dest, time_hour) |>
left_join(weather) |>
summarise(
missing_temp = mean(is.na(temp) & is.na(wind_speed)),
missing_dewp = mean(is.na(dewp))
)
flights |>
select(year, month, day, origin, dest, time_hour) |>
left_join(weather) |>
summarise(
missing_temp_or_windspeed = mean(is.na(temp) & is.na(wind_speed)),
missing_dewp = mean(is.na(dewp))
)
flights |>
anti_join(weather)
flights |>
anti_join(weather) |>
nrow()
1556/nrow(flights)
flights |>
anti_join(weather) |>
nrow()
flights |>
anti_join(weather) |>
distinct(time_hour)
flights |>
anti_join(weather) |>
distinct(origin)
# Numb
flights |>
anti_join(weather) |>
nrow()
flights |>
select(year, month, day, origin, dest, time_hour) |>
left_join(weather) |>
summarise(
missing_temp_or_windspeed = mean(is.na(temp) & is.na(wind_speed)),
missing_dewp = mean(is.na(dewp))
)
# A check to confirm our results
flights |>
select(year, month, day, origin, dest, time_hour) |>
left_join(weather) |>
summarise(
missing_temp_or_windspeed = mean(is.na(temp) & is.na(wind_speed)),
missing_dewp = mean(is.na(dewp))
)
as.numeric(flights |>
anti_join(weather) |>
nrow())/nrow(flights)
weather |>
filter(is.na(temp))
flights |>
anti_join(planes)
?anti_join
flights |>
anti_join(planes, by = join_by(tailnum))
flights |>
anti_join(planes, by = join_by(tailnum)) |>
group_by(carrier) |>
count()
flights |>
anti_join(planes, by = join_by(tailnum))
# Create a unique flight ID for each flight
flights2 <- flights |>
mutate(id = row_number(), .before = 1)
flights2 |>
anti_join(planes, by = join_by(tailnum))
# Create a unique flight ID for each flight
flights2 <- flights |>
mutate(id = row_number(), .before = 1)
flights2 |>
anti_join(planes, by = join_by(tailnum))
flights2 |>
anti_join(planes, by = join_by(tailnum)) |>
select(id) |>
as_vector() |> unname()
ids_no_record = flights2 |>
anti_join(planes, by = join_by(tailnum)) |>
select(id) |>
as_vector() |> unname()
flights2 = flights2 |>
mutate(missing_record = id %in% ids_no_record)
names(flights2)
flights2
flights2 |>
group_by(missing_record) |>
ggplot(aes(fill = carrier)) +
geom_bar()
flights2 |>
group_by(missing_record) |>
count(carrier)
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = "", y = n,
fill = carrier)) +
geom_bar(stat = "identity")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = "", y = n,
fill = carrier)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record)
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = "", y = n,
fill = carrier)) +
geom_bar(stat = "identity") +
coord_polar(theta = "y") +
facet_wrap(~ missing_record)
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = "", y = n,
fill = carrier)) +
geom_bar(stat = "identity") +
coord_polar(theta = "y") +
facet_wrap(~ missing_record, scales = "free")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = n, y = carrier)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record, scales = "free")
label_vec = c(FALSE, TRUE)
names(label_vec = c("Flights with missing tailnum in planes", "Other flights"))
names(label_vec) = c("Flights with missing tailnum in planes", "Other flights"))
names(label_vec) = c("Flights with missing tailnum in planes", "Other flights")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = n, y = carrier)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record, scales = "free", labeller = labeller(missing_record = label_vec))
?facet_wrap
label_vec
labeller(missing_record = label_vec)
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = n, y = carrier)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free",
labeller = labeller(missing_record = label_vec))
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = n, y = carrier)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
labeller = labeller(missing_record = label_vec))
flights2 |>
group_by(missing_record) |>
count(carrier) |>
ggplot(aes(x = n, y = carrier)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec))
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec))
names(label_vec) = c(FALSE, TRUE)
label_vec = c("Flights with missing tailnum in planes", "Other flights")
label_vec
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec))
flights2 = flights2 |>
mutate(
missing_record = id %in% ids_no_record,
missing_record = missing_record + 1
)
# Create a unique flight ID for each flight
flights2 <- flights |>
mutate(id = row_number(), .before = 1)
ids_no_record = flights2 |>
anti_join(planes, by = join_by(tailnum)) |>
select(id) |>
as_vector() |> unname()
flights2 = flights2 |>
mutate(
missing_record = id %in% ids_no_record,
missing_record = missing_record + 1
)
names(label_vec) = c(1, 2)
label_vec = c("Flights with missing tailnum in planes", "Other flights")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec))
label_vec
names(label_vec) = c(1, 2)
label_vec
label_vec = c("Flights with missing tailnum in planes", "Other flights")
names(label_vec) = c(FALSE, TRUE)
label_vec
# Create a unique flight ID for each flight
flights2 <- flights |>
mutate(id = row_number(), .before = 1)
ids_no_record = flights2 |>
anti_join(planes, by = join_by(tailnum)) |>
select(id) |>
as_vector() |> unname()
flights2 = flights2 |>
mutate(
missing_record = id %in% ids_no_record
)
label_vec = c("Flights with missing tailnum in planes", "Other flights")
names(label_vec) = c(FALSE, TRUE)
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec))
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_classic() +
labs(x = "Number of flights",  y ="Carrier")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_minimal() +
theme(panel.grid = element_blank()) +
labs(x = "Number of flights",  y ="Carrier")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_classic() +
theme(axis.line.y = element_blank()) +
labs(x = "Number of flights",  y ="Carrier")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_classic() +
theme(legend.position = "none") +
labs(x = "Number of flights",  y = "Carrier",
title = "Flights with missing tailnum in planes belong to a select few carriers")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_light() +
theme(legend.position = "none") +
labs(x = "Number of flights",  y = "Carrier",
title = "Flights with missing tailnum in planes belong to a select few carriers")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_bw() +
theme(legend.position = "none") +
labs(x = "Number of flights",  y = "Carrier",
title = "Flights with missing tailnum in planes belong to a select few carriers")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_bw() +
theme(legend.position = "none") +
labs(x = "Number of flights",  y = "Carrier",
title = "Flights with missing tailnum in planes belong to a select few carriers") +
scale_fill_brewer(palette = "set1")
flights2 |>
group_by(missing_record) |>
count(carrier) |>
mutate(col_var = carrier %in% c("MQ", "AA")) |>
ggplot(aes(x = n, y = carrier, fill = col_var)) +
geom_bar(stat = "identity") +
facet_wrap(~ missing_record,
scales = "free_x",
labeller = labeller(missing_record = label_vec)) +
theme_bw() +
theme(legend.position = "none") +
labs(x = "Number of flights",  y = "Carrier",
title = "Flights with missing tailnum in planes belong to a select few carriers") +
scale_fill_brewer(palette = "Set2")
flights |>
group_by(tailnum) |>
distinct(carrier)
flights |>
group_by(tailnum) |>
count(carrier)
flights |>
group_by(tailnum) |>
summarise(car_nums = n_distinct(carrier))
flights |>
group_by(tailnum) |>
summarise(car_nums = n_distinct(carrier)) |>
arrange(desc(car_nums))
planes |>
left_join((flights |> select(tailnum, carrier)))
planes
# Checking the number of distinct carriers for each tailnum (i.e. each airplane)
flights |>
group_by(tailnum) |>
summarise(car_nums = n_distinct(carrier)) |>
arrange(desc(car_nums))
# Checking the number of distinct carriers for each tailnum (i.e. each airplane)
flights |>
group_by(tailnum) |>
summarise(car_nums = n_distinct(carrier)) |>
arrange(desc(car_nums)) |>
drop_na()
# Checking the number of distinct carriers for each tailnum (i.e. each airplane)
flights |>
group_by(tailnum) |>
summarise(car_nums = n_distinct(carrier)) |>
drop_na() |>
filter(car_nums > 1)
# Checking the number of distinct carriers for each tailnum (i.e. each airplane)
flights |>
group_by(tailnum) |>
summarise(
carrier_num = n_distinct(carrier)
carrier_name = distinct(carrier)) |>
# Checking the number of distinct carriers for each tailnum (i.e. each airplane)
flights |>
group_by(tailnum) |>
summarise(
carrier_num = n_distinct(carrier),
carrier_name = distinct(carrier)) |>
drop_na() |>
filter(carrier_num > 1)
# Checking the number of distinct carriers for each tailnum (i.e. each airplane)
flights |>
group_by(tailnum) |>
summarise(
carrier_num = n_distinct(carrier),
carrier_name = str_flatten(distinct(carrier), collapse = " ")) |>
drop_na() |>
filter(carrier_num > 1)
